#!/bin/bash
set -e

ARCH=${ARCH:-arm64}
NODE=${NODE:-8.6.0}

export npm_config_arch=$ARCH
export npm_config_platform=ios
export npm_config_nodedir=~/libnode/
#export npm_config_node_engine=v8
#export npm_config_node_gyp=
export GYP_DEFINES="OS=ios host_os=mac target_arch=arm64 target_subarch=arm64"

node-gyp rebuild --target=$NODE -v
#node-pre-gyp --target_platform=android --target_libc=unknown --target_arch=arm64  --target=$NODE --build-from-source install --library=static_library

cp build/Release/pkcs11.a binary/node-v57-ios-arm64-unknown
