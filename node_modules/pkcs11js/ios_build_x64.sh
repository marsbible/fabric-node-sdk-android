#!/bin/bash
set -e

ARCH=${ARCH:-x64}
NODE=${NODE:-8.6.0}

export npm_config_arch=$ARCH
export npm_config_platform=ios
export npm_config_nodedir=~/libnode/
#export npm_config_node_engine=v8
#export npm_config_node_gyp=
export GYP_DEFINES="OS=ios host_os=mac target_arch=x64 target_subarch=x64"

node-gyp rebuild --target=$NODE -v

cp build/Release/pkcs11.a binary/node-v57-ios-x64-unknown
